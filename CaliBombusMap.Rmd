---
title: "CaliBombus Map"
output: html_document
---

#Load Packages
```{r}
library(dplyr)
library(ggplot2)
library(tidyr)
library(sf)
library(tmap)


```
#Import data 
```{r}
#Import ecoregion shape file from EPA/USGS Level III 
ecoregionshape<-st_read("./ca_eco_l3/ca_eco_l3.shp") %>% st_transform("+proj=longlat +datum=WGS84")
head(ecoregionshape)
#Check coordinate system 
st_crs(ecoregionshape)
ecoregionshape$L3_KEY

#Import site information 

site<-read.csv("./spatialinfofinal.csv") %>% select(Site_Grouping, lon, lat) 
site
#Have to put in as long/lat
site.sf <- st_as_sf(site, coords = c("lon", "lat"), crs = 4326) %>% st_transform("+proj=longlat +datum=WGS84")
site.sf


#Map with Labels 
tm_shape(ecoregionshape) + tm_polygons(col="US_L3NAME", border.col="white", palette="PuBuGn", title="Ecoregion")+ tm_legend(outside = TRUE)+tm_shape(site.sf) + tm_dots(size=0.2, col="black")+tm_text("Site_Grouping", just = "left", ymod = 0.5, size = 0.8) 

#Map without labels
tm_shape(ecoregionshape) + tm_polygons(col="US_L3NAME", border.col="white", palette="PuBuGn", title="Ecoregion")+tm_shape(site.sf) + tm_dots(size=0.2, col="black")+
  tm_layout(frame=FALSE)+tm_legend(outside=TRUE, legend.position=c("right", "top"))


```

## NIFA MAP 
```{r}
#Import new NIFA sites 
NIFAsites<-read.csv("./NIFASites.csv") %>% mutate(sampled="no") %>% select(Site, lon, lat, Ecoregion, sampled) 
NIFAsites

sitecali<-read.csv("./spatialinfofinal.csv") %>% select(Site_Grouping, lon, lat, Ecoregion.1) 

#Combine NIFA with calibombus sites 
calisites<-sitecali %>% select(Site_Grouping, lon, lat, Ecoregion.1) %>% rename(Site=Site_Grouping) %>% rename(Ecoregion=Ecoregion.1) %>% mutate(sampled="yes")
calisites

#Bind both dataframes 
Sites_NIFA<-rbind(NIFAsites, calisites)
Sites_NIFA

#Have to put in as long/lat
site.sf <- st_as_sf(Sites_NIFA, coords = c("lon", "lat"), crs = 4326) %>% st_transform("+proj=longlat +datum=WGS84")
site.sf

tm_shape(ecoregionshape) + 
  tm_polygons(col="US_L3NAME", border.col="white", palette="PuBuGn", title="Ecoregion")+
  tm_shape(site.sf) + 
  tm_dots(size=0.2, col="sampled", palette=c(yes='black', no='red'), title="Sampling Status")+
  tm_layout(frame=FALSE, legend.text.size=0.4, legend.width=1)+tm_legend(legend.position=c("left", "top"), outside=TRUE)






```
